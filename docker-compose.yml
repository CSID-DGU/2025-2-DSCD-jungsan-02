version: '3.8'

services:
  flask-app:
    image: jang99u/lostfound-flask:latest
    container_name: flask-app
    ports:
      - "5001:5001"
    gpus: all
    environment:
      CAPTION_MODEL_ID: "Qwen/Qwen2.5-VL-7B-Instruct"
      EMBEDDING_MODEL_NAME: "BAAI/bge-m3"
      EMBEDDING_DIMENSION: "1024"
      FAISS_STORAGE_DIR: "/app/faiss-data"
      GUNICORN_WORKERS: "2"  # Qwen 7B 모델 리소스 고려하여 2개로 감소 (메모리 절약) 
    volumes:
      - ./faiss-data:/app/faiss-data
    networks:
      - backend

  spring-app:
    image: jang99u/lostfound-spring:latest
    container_name: spring-app
    depends_on:
      - flask-app
    ports:
      - "8080:8080"
    volumes:
      - /home/mj:/data  # 호스트의 /home/mj를 컨테이너의 /data로 마운트
    networks:
      - backend

networks:
  backend:
